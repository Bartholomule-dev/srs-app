# exercises/python/error-handling.yaml
language: python
category: error-handling

exercises:
  - slug: try-except-basic
    objective: Write a basic try-except block to catch exceptions
    title: Try Except Basic
    difficulty: 2
    prompt: Write a try/except skeleton that catches Exception. Use pass in both blocks.
    expected_answer: |
      try:
          pass
      except Exception:
          pass
    accepted_solutions:
      - |
        try:
            pass
        except Exception:
            pass
      - |
        try:
          pass
        except Exception:
          pass
    hints:
      - Use try and except keywords for {{item_singular}} safety
      - Catch Exception to handle errors when {{action_verb}}ing {{item_plural}}
    tags: [exceptions, try, intermediate]
    concept: error-handling
    subconcept: try-except
    level: intro
    prereqs: [functions]
    type: write
    pattern: handling

  - slug: except-specific
    objective: Handle lookup failures with specific exception
    title: Key Not Found Error
    difficulty: 2
    prompt: Write the except clause that catches KeyError when a key is missing from a dictionary.
    expected_answer: "except KeyError:"
    accepted_solutions:
      - "except KeyError:"
      - "except KeyError :"
    hints:
      - Put exception type after the except keyword
      - KeyError is raised when accessing a missing dictionary key
    tags: [exceptions, key-error]
    concept: error-handling
    subconcept: try-except
    level: intro
    prereqs: [functions]
    type: write
    pattern: handling

  - slug: raise-exception
    objective: Raise a validation error when input fails rules
    title: Validation Error
    difficulty: 2
    prompt: Raise a ValueError with message "Invalid {{item_singular}}"
    expected_answer: 'raise ValueError("Invalid {{item_singular}}")'
    accepted_solutions:
      - 'raise ValueError("Invalid {{item_singular}}")'
      - "raise ValueError('Invalid {{item_singular}}')"
    hints:
      - Use the raise keyword
      - Descriptive messages help debugging
    tags: [exceptions, validation]
    concept: error-handling
    subconcept: raising
    level: practice
    prereqs: [functions]
    type: write
    pattern: handling

  - slug: except-as
    objective: Catch an exception and bind it to a variable using the as keyword
    title: Except with Alias
    difficulty: 2
    prompt: Write an except clause that catches Exception and binds it to a variable named error
    expected_answer: "except Exception as error:"
    accepted_solutions:
      - "except Exception as error:"
      - "except Exception as e:"
      - "except Exception as err:"
    hints:
      - Use 'as' to bind the exception to a variable name
      - Allows access to error message with str(error)
    tags: [exceptions, alias, intermediate]
    concept: error-handling
    subconcept: try-except
    level: practice
    prereqs: [functions]
    type: write
    pattern: handling

  # --- Finally Subconcept ---
  - slug: finally-basic
    objective: Write a finally block that always executes
    title: Basic Finally
    difficulty: 2
    concept: error-handling
    subconcept: finally
    level: intro
    prereqs: [try-except]
    type: write
    pattern: handling
    prompt: Write only the line that begins a finally block.
    expected_answer: "finally:"
    accepted_solutions:
      - "finally:"
      - "finally :"
    hints:
      - finally runs whether {{item_singular}} exception occurs or not
      - Use for cleanup code (closing files, saving state)
    tags: [exceptions, finally, cleanup]

  - slug: finally-cleanup
    objective: Use finally to ensure cleanup code always runs
    title: Finally Cleanup
    difficulty: 2
    concept: error-handling
    subconcept: finally
    level: intro
    prereqs: [finally]
    type: write
    pattern: handling
    prompt: Close the {{filename}} file object f in a finally block after {{action_verb}}ing {{item_plural}}
    expected_answer: |
      finally:
          f.close()
    accepted_solutions:
      - |
        finally:
            f.close()
      - |
        finally:
          f.close()
    hints:
      - finally ensures {{item_singular}} cleanup happens
      - Even if {{item_singular}} exception occurs
    tags: [exceptions, finally, cleanup]

  - slug: finally-with-except
    objective: Combine try, except, and finally blocks
    title: Try-Except-Finally
    difficulty: 2
    concept: error-handling
    subconcept: finally
    level: practice
    prereqs: [finally]
    type: write
    pattern: handling
    prompt: Write a try/except/finally skeleton. Use pass in each block and catch Exception.
    expected_answer: |
      try:
          pass
      except Exception:
          pass
      finally:
          pass
    accepted_solutions:
      - |
        try:
            pass
        except Exception:
            pass
        finally:
            pass
      - |
        try:
          pass
        except Exception:
          pass
        finally:
          pass
    hints:
      - finally comes after except when {{action_verb}}ing {{item_plural}}
      - All three blocks together for complete {{item_singular}} handling
    tags: [exceptions, finally, complete]

  - slug: finally-return
    objective: Understand that finally runs even after return statements
    title: Finally After Return
    difficulty: 3
    concept: error-handling
    subconcept: finally
    level: practice
    prereqs: [finally]
    type: predict
    grading_strategy: execution
    pattern: handling
    prompt: What does this code print? List each line of output.
    code: |
      def {{action_verb}}_{{item_singular}}():
          try:
              return "{{status_var}}"
          finally:
              print("cleanup")
      result = {{action_verb}}_{{item_singular}}()
      print(result)
    expected_answer: |
      cleanup
      {{status_var}}
    hints:
      - finally runs before the function actually returns
      - Return value is held until finally completes
    tags: [exceptions, finally, return]

  - slug: finally-exception-propagation
    objective: Understand that finally runs even when exceptions propagate
    title: Finally With Propagation
    difficulty: 3
    concept: error-handling
    subconcept: finally
    level: edge
    prereqs: [finally]
    type: predict
    grading_strategy: execution
    pattern: handling
    prompt: What does this code print before it crashes? List each line.
    code: |
      try:
          print("{{action_verb}}ing")
          raise ValueError("Invalid {{item_singular}}")
      finally:
          print("cleanup")
    expected_answer: |
      {{action_verb}}ing
      cleanup
    hints:
      - finally runs before the exception propagates
      - Exception continues after finally completes
    tags: [exceptions, finally, propagation]

  - slug: else-clause
    objective: Use else clause that runs when no exception occurs
    title: Try-Else Clause
    difficulty: 2
    concept: error-handling
    subconcept: finally
    level: intro
    prereqs: [try-except]
    type: write
    pattern: handling
    prompt: In a try/except, write an else block that runs only when no exception occurs. Use pass for the body.
    expected_answer: |
      else:
          pass
    accepted_solutions:
      - |
        else:
            pass
      - |
        else:
          pass
    hints:
      - else comes between except and finally
      - Runs only if no exception occurred in try block
    tags: [exceptions, else, control]

  # --- Additional Raising Exercises ---
  - slug: raise-intro
    objective: Raise a basic exception to signal an error
    title: Raise Exception Intro
    difficulty: 1
    concept: error-handling
    subconcept: raising
    level: intro
    prereqs: [try-except]
    type: write
    pattern: handling
    prompt: Write the statement to raise a generic Exception (no message needed).
    expected_answer: "raise Exception()"
    accepted_solutions:
      - "raise Exception()"
      - "raise Exception"
    hints:
      - Use the raise keyword followed by the exception type
      - Exception is the base exception class
    tags: [exceptions, raise, intro]

  - slug: raise-custom-message
    objective: Raise an exception with a descriptive error message
    title: Raise with Message
    difficulty: 2
    concept: error-handling
    subconcept: raising
    level: intro
    prereqs: [try-except]
    type: write
    pattern: handling
    prompt: Raise a ValueError when {{item_singular}} with message "{{entity_name}} not found"
    expected_answer: 'raise ValueError("{{entity_name}} not found")'
    accepted_solutions:
      - 'raise ValueError("{{entity_name}} not found")'
      - "raise ValueError('{{entity_name}} not found')"
    hints:
      - Pass {{item_singular}} message string to exception constructor
      - Good messages describe what {{item_singular}} went wrong
    tags: [exceptions, raise, message]

  - slug: raise-from
    objective: Chain exceptions using raise...from to preserve context
    title: Exception Chaining
    difficulty: 3
    concept: error-handling
    subconcept: raising
    level: practice
    prereqs: [raising]
    type: write
    pattern: handling
    prompt: Raise RuntimeError with message "Failed to {{action_verb}} {{item_singular}}" from an existing exception e
    expected_answer: 'raise RuntimeError("Failed to {{action_verb}} {{item_singular}}") from e'
    accepted_solutions:
      - 'raise RuntimeError("Failed to {{action_verb}} {{item_singular}}") from e'
      - "raise RuntimeError('Failed to {{action_verb}} {{item_singular}}') from e"
    hints:
      - Use 'from' to chain exceptions
      - Preserves original traceback
    tags: [exceptions, raise, chaining]

  - slug: reraise
    objective: Re-raise the current exception using bare raise
    title: Re-raise Exception
    difficulty: 2
    concept: error-handling
    subconcept: raising
    level: practice
    prereqs: [raising]
    type: write
    pattern: handling
    prompt: Write the statement to re-raise the current exception (inside an except block).
    expected_answer: raise
    accepted_solutions:
      - raise
    hints:
      - Bare 'raise' re-raises current {{item_singular}} exception
      - Preserves original traceback for debugging
    tags: [exceptions, raise, reraise]

  - slug: custom-exception
    objective: Define a custom exception class
    title: Custom Exception
    difficulty: 3
    concept: error-handling
    subconcept: raising
    level: edge
    prereqs: [raising, inheritance]
    type: write
    pattern: definition
    prompt: Define a custom exception class {{entity_name}}Error that inherits from Exception. Use pass for the body.
    expected_answer: |
      class {{entity_name}}Error(Exception):
          pass
    accepted_solutions:
      - |
        class {{entity_name}}Error(Exception):
            pass
      - |
        class {{entity_name}}Error(Exception):
          pass
    hints:
      - Inherit from Exception using class Name(Exception)
      - Custom exceptions can add attributes later
    tags: [exceptions, custom, class]

  # --- Fill-in Exercises ---
  - slug: try-keyword-fill
    objective: Complete the try block keyword
    title: Try Keyword Fill-in
    difficulty: 1
    concept: error-handling
    subconcept: try-except
    level: intro
    prereqs: []
    type: fill-in
    blank_position: 0
    pattern: handling
    prompt: Fill in the keyword that starts error handling for {{action_verb}}ing {{item_singular}}
    template: |
      ___:
          {{action_verb}}_{{item_singular}}()
    expected_answer: "try"
    hints:
      - Keyword that starts exception handling block
      - Usually paired with except
    tags: [exceptions, try, fill-in]

  - slug: except-keyword-fill
    objective: Complete the except clause
    title: Except Keyword Fill-in
    difficulty: 1
    concept: error-handling
    subconcept: try-except
    level: intro
    prereqs: [try-except]
    type: fill-in
    blank_position: 0
    pattern: handling
    prompt: Fill in the keyword that catches an invalid {{item_singular}} exception
    template: "___ ValueError:"
    expected_answer: "except"
    hints:
      - Keyword that catches {{item_singular}} exceptions
      - Comes after the try block when {{action_verb}}ing {{item_plural}}
    tags: [exceptions, except, fill-in]

  - slug: raise-keyword-fill
    objective: Complete the raise statement
    title: Raise Keyword Fill-in
    difficulty: 2
    concept: error-handling
    subconcept: raising
    level: practice
    prereqs: [try-except]
    type: fill-in
    blank_position: 0
    pattern: handling
    prompt: Fill in the keyword that throws an exception for invalid {{item_singular}}
    template: '___ ValueError("Invalid {{item_singular}}")'
    expected_answer: "raise"
    hints:
      - Keyword to throw a {{item_singular}} exception
      - Stops normal {{action_verb}} execution flow
    tags: [exceptions, raise, fill-in]

  # --- Predict Exercises ---
  - slug: try-except-predict
    objective: Predict which block executes
    title: Try-Except Flow Predict
    difficulty: 2
    concept: error-handling
    subconcept: try-except
    level: intro
    prereqs: [try-except]
    type: predict
    grading_strategy: execution
    pattern: handling
    generator: try-except-flow
    prompt: What does this code print?
    code: |
      try:
          x = int({{value}})
          print("success")
      except ValueError:
          print("error")
    expected_answer: "{{output}}"
    hints:
      - Think about whether int({{value}}) is valid
      - Invalid conversion raises ValueError
    tags: [exceptions, try-except, predict, dynamic]

  - slug: except-type-predict
    objective: Predict exception type matching
    title: Exception Type Predict
    difficulty: 2
    concept: error-handling
    subconcept: try-except
    level: practice
    prereqs: [try-except]
    type: predict
    grading_strategy: execution
    pattern: handling
    prompt: What does this try-except code print?
    code: |
      try:
          {{item_singular}}_count = 1 / 0
      except ValueError:
          print("invalid {{item_singular}}")
      except ZeroDivisionError:
          print("zero {{item_plural}}")
    expected_answer: "zero {{item_plural}}"
    hints:
      - 1/0 raises ZeroDivisionError, not ValueError
      - The matching {{item_singular}} except block is executed
    tags: [exceptions, except, predict]

  - slug: exception-as-predict
    objective: Predict exception message access
    title: Exception As Predict
    difficulty: 2
    concept: error-handling
    subconcept: try-except
    level: practice
    prereqs: [try-except]
    type: predict
    grading_strategy: execution
    pattern: handling
    prompt: What does this try-except code print?
    code: |
      try:
          raise ValueError("Invalid {{item_singular}}")
      except ValueError as e:
          print(e)
    expected_answer: "Invalid {{item_singular}}"
    hints:
      - "'as e' captures the {{item_singular}} exception object"
      - str(e) or print(e) shows the {{item_singular}} message
    tags: [exceptions, as, predict]

  # --- Dynamic Exception Exercises ---
  - slug: exception-catch-dynamic
    objective: Write the correct except clause for a given exception type
    title: Dynamic Exception Catch
    difficulty: 2
    concept: error-handling
    subconcept: try-except
    level: practice
    prereqs: [try-except]
    type: write
    pattern: handling
    generator: exception-scenario
    prompt: "Write the except clause to catch a {{exceptionType}} ({{context}} context)"
    expected_answer: "{{catchBlock}}"
    accepted_solutions:
      - "{{catchBlock}}"
    hints:
      - "This exception is raised during {{operation}}"
      - "Use except followed by the exception type"
    tags: [exceptions, catch, dynamic, write]

  - slug: exception-type-predict-dynamic
    objective: Predict which exception type is raised
    title: Dynamic Exception Type
    difficulty: 2
    concept: error-handling
    subconcept: try-except
    level: practice
    prereqs: [try-except]
    type: predict
    grading_strategy: execution
    pattern: handling
    generator: exception-scenario
    prompt: "What exception type does this code raise? (Answer with just the exception class name, e.g. ValueError)"
    code: "{{code}}"
    expected_answer: "{{exceptionType}}"
    hints:
      - "Think about what operation is being performed"
      - "Context: {{context}}"
    tags: [exceptions, type, dynamic, predict]

  # --- Finally Flow Dynamic Exercises ---
  - slug: finally-flow-predict-dynamic
    objective: Predict the output of try/except/finally blocks
    title: Dynamic Finally Flow
    difficulty: 3
    concept: error-handling
    subconcept: finally
    level: practice
    prereqs: [try-except]
    type: predict
    grading_strategy: execution
    pattern: handling
    generator: finally-flow
    prompt: "What does this code print? (List each line of output)"
    code: "{{code}}"
    expected_answer: "{{outputStr}}"
    hints:
      - "{{description}}"
      - "Finally block always executes"
    tags: [exceptions, finally, dynamic, predict]

  - slug: finally-trace-dynamic
    objective: Trace execution through try/except/finally
    title: Dynamic Finally Trace
    difficulty: 3
    concept: error-handling
    subconcept: finally
    level: edge
    prereqs: [finally]
    type: predict
    grading_strategy: execution
    pattern: handling
    generator: finally-flow
    prompt: "How many times does print() run? Answer with a single integer."
    code: "{{code}}"
    expected_answer: "{{outputCount}}"
    hints:
      - "Count: try block prints + except block prints (if exception) + finally block prints"
      - "{{description}}"
    tags: [exceptions, finally, trace, dynamic]

  # --- Integrated Exercises (Multi-Concept) ---
  - slug: error-handling-file-read
    objective: Handle file reading errors with proper exception handling
    title: Safe File Read
    difficulty: 3
    concept: error-handling
    subconcept: try-except
    level: edge
    prereqs: [try-except, reading]
    type: write
    pattern: handling
    prompt: |
      Write code that tries to read {{filename}} and stores content in {{item_singular}}_data.
      Handle FileNotFoundError by setting {{item_singular}}_data to an empty string.
    expected_answer: |
      try:
          with open("{{filename}}") as f:
              {{item_singular}}_data = f.read()
      except FileNotFoundError:
          {{item_singular}}_data = ""
    accepted_solutions:
      - |
        try:
            with open("{{filename}}") as f:
                {{item_singular}}_data = f.read()
        except FileNotFoundError:
            {{item_singular}}_data = ""
      - |
        try:
            with open('{{filename}}') as f:
                {{item_singular}}_data = f.read()
        except FileNotFoundError:
            {{item_singular}}_data = ''
    hints:
      - "Use with statement for safe file handling"
      - "Catch FileNotFoundError specifically"
      - "Provide a fallback value in the except block"
    tags: [exceptions, files]

  - slug: error-handling-dict-access
    objective: Safely access dictionary keys with exception handling
    title: Safe Dict Access
    difficulty: 3
    concept: error-handling
    subconcept: try-except
    level: edge
    prereqs: [try-except, dicts]
    type: write
    pattern: handling
    prompt: |
      Try to get {{item_singular}}_data["{{attr_key_1}}"] and store in result.
      Handle KeyError by setting result to "Unknown".
    expected_answer: |
      try:
          result = {{item_singular}}_data["{{attr_key_1}}"]
      except KeyError:
          result = "Unknown"
    accepted_solutions:
      - |
        try:
            result = {{item_singular}}_data["{{attr_key_1}}"]
        except KeyError:
            result = "Unknown"
      - |
        try:
            result = {{item_singular}}_data['{{attr_key_1}}']
        except KeyError:
            result = 'Unknown'
    hints:
      - "KeyError is raised when a key doesn't exist"
      - "Provide a default value in the except block"
      - "Alternatively, use .get() method for simpler cases"
    tags: [exceptions, dicts]

  - slug: error-handling-conversion
    objective: Handle type conversion errors with proper fallback
    title: Safe Type Conversion
    difficulty: 3
    concept: error-handling
    subconcept: try-except
    level: edge
    prereqs: [try-except, conversion]
    type: write
    pattern: handling
    prompt: |
      Try to convert {{item_singular}}_input to an integer and store in {{item_singular}}_count.
      Handle ValueError by setting {{item_singular}}_count to 0.
    expected_answer: |
      try:
          {{item_singular}}_count = int({{item_singular}}_input)
      except ValueError:
          {{item_singular}}_count = 0
    accepted_solutions:
      - |
        try:
            {{item_singular}}_count = int({{item_singular}}_input)
        except ValueError:
            {{item_singular}}_count = 0
    hints:
      - "int() raises ValueError for non-numeric strings"
      - "Provide a sensible default in the except block"
    tags: [exceptions, conversion]

  # --- Trade-off Exercises (Senior-Level Decision Making) ---