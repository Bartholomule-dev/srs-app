# exercises/python/comprehensions.yaml
language: python
category: comprehensions

exercises:
  - slug: list-comp-basic
    objective: "Write a basic list comprehension to transform a range into squares"
    title: List Comprehension Basic
    difficulty: 2
    prompt: Create a list of squares from 1 to 5 using comprehension
    expected_answer: "[x**2 for x in range(1, 6)]"
    hints:
      - Use [expression for item in iterable]
    tags: [comprehensions, lists, intermediate]
    concept: comprehensions
    subconcept: list-comp
    level: intro
    prereqs: [for, iteration, lists]
    type: write
    pattern: mapping

  - slug: list-comp-conditional
    objective: "Create a list comprehension with a filter condition"
    title: List Comprehension Conditional
    difficulty: 2
    prompt: Create a list of even numbers from 1 to 10 using comprehension
    expected_answer: "[x for x in range(1, 11) if x % 2 == 0]"
    hints:
      - Add if condition at the end
    tags: [comprehensions, conditionals, intermediate]
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [for, iteration, lists, conditionals]
    type: write
    pattern: filtering

  # --- Dict Comprehension Intro ---
  - slug: dict-comp-intro
    objective: Create a dictionary using comprehension syntax
    title: Basic Dict Comprehension
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: intro
    prereqs: [comprehensions.list-comp]
    type: write
    pattern: mapping
    prompt: Create a dict mapping numbers 1-3 to their squares using comprehension
    expected_answer: "{x: x**2 for x in range(1, 4)}"
    accepted_solutions:
      - "{x: x**2 for x in range(1, 4)}"
      - "{x: x*x for x in range(1, 4)}"
      - "{i: i**2 for i in range(1, 4)}"
      - "{i: i*i for i in range(1, 4)}"
    hints:
      - "Dict comprehension uses {key: value for ...}"
      - "range(1, 4) gives 1, 2, 3"
    tags: [comprehensions, dict, intro]

  - slug: dict-comp-predict-intro
    objective: Predict the output of a simple dict comprehension
    title: Dict Comprehension Output
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: intro
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: mapping
    prompt: What does this create?
    code: "{x: x*2 for x in [1, 2, 3]}"
    expected_answer: "{1: 2, 2: 4, 3: 6}"
    hints:
      - "Each x becomes a key"
      - "x*2 becomes its value"
    tags: [comprehensions, dict, intro, predict]

  - slug: dict-comp-basic
    objective: "Write a dictionary comprehension to map keys to computed values"
    title: Dict Comprehension
    difficulty: 3
    prompt: Create a dict mapping numbers 1-3 to their squares
    expected_answer: "{x: x**2 for x in range(1, 4)}"
    hints:
      - "Use {key: value for item in iterable}"
    tags: [comprehensions, dicts, advanced]
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [for, iteration, dicts, list-comp]
    type: write
    pattern: mapping

  # --- Set Comprehension Intro ---
  - slug: set-comp-intro
    objective: Create a set using comprehension syntax
    title: Basic Set Comprehension
    difficulty: 2
    concept: comprehensions
    subconcept: set-comp
    level: intro
    prereqs: [comprehensions.list-comp]
    type: write
    pattern: mapping
    prompt: Create a set of squares for numbers 1-4 using comprehension
    expected_answer: "{x**2 for x in range(1, 5)}"
    accepted_solutions:
      - "{x**2 for x in range(1, 5)}"
      - "{x*x for x in range(1, 5)}"
      - "{i**2 for i in range(1, 5)}"
    hints:
      - "Set comprehension uses {expr for ...} (no colon)"
      - "Duplicates are automatically removed"
    tags: [comprehensions, set, intro]

  - slug: set-comp-predict-intro
    objective: Predict the output of a set comprehension with duplicates
    title: Set Comprehension Deduplication
    difficulty: 2
    concept: comprehensions
    subconcept: set-comp
    level: intro
    prereqs: [comprehensions.set-comp]
    type: predict
    pattern: mapping
    prompt: What does this create?
    code: "{x % 3 for x in [1, 2, 3, 4, 5, 6]}"
    expected_answer: "{0, 1, 2}"
    accepted_solutions:
      - "{0, 1, 2}"
      - "{1, 2, 0}"
      - "{2, 1, 0}"
    hints:
      - "Sets remove duplicates"
      - "1%3=1, 2%3=2, 3%3=0, 4%3=1, 5%3=2, 6%3=0"
    tags: [comprehensions, set, intro, predict]

  - slug: set-comp-basic
    objective: "Use set comprehension to create a collection of unique values"
    title: Set Comprehension
    difficulty: 3
    prompt: Create a set of first letters from list of words
    expected_answer: "{word[0] for word in words}"
    hints:
      - Use curly braces like dict but without colon
    tags: [comprehensions, sets, advanced]
    concept: comprehensions
    subconcept: set-comp
    level: practice
    prereqs: [for, sets, strings, list-comp]
    type: write
    pattern: mapping

  - slug: nested-comp
    objective: "Apply nested loops in a list comprehension to flatten a matrix"
    title: Nested Comprehension
    difficulty: 3
    prompt: Flatten a 2D list called matrix using comprehension
    expected_answer: "[item for row in matrix for item in row]"
    hints:
      - Use multiple for clauses
      - Outer loop comes first
    tags: [comprehensions, nested, advanced]
    concept: comprehensions
    subconcept: list-comp
    level: edge
    prereqs: [for, lists, list-comp]
    type: write
    pattern: mapping

  # --- Generator Expression Subconcept ---
  - slug: generator-exp-basic
    objective: "Write a generator expression for memory-efficient iteration"
    title: Generator Expression
    difficulty: 2
    concept: comprehensions
    subconcept: generator-exp
    level: intro
    prereqs: [comprehensions.list-comp]
    type: write
    pattern: mapping
    prompt: Create a generator of squares from 1 to 5
    expected_answer: (x**2 for x in range(1, 6))
    hints:
      - Use parentheses instead of brackets
      - Creates iterator, not list
    tags: [comprehensions, generator, memory]

  - slug: generator-exp-sum
    objective: "Use a generator expression with an aggregate function"
    title: Sum with Generator
    difficulty: 2
    concept: comprehensions
    subconcept: generator-exp
    level: practice
    prereqs: [comprehensions.generator-exp]
    type: write
    pattern: aggregation
    prompt: Sum all squares from 1 to 100 using generator expression
    expected_answer: sum(x**2 for x in range(1, 101))
    hints:
      - No extra parentheses needed inside sum()
    tags: [comprehensions, generator, sum]

  # --- Additional List Comp ---
  - slug: list-comp-ternary
    objective: "Apply a ternary expression inside a list comprehension"
    title: List Comp with Ternary
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: edge
    prereqs: [comprehensions.list-comp]
    type: write
    pattern: transformation
    prompt: Create list replacing negative numbers with 0 from list nums
    expected_answer: "[x if x >= 0 else 0 for x in nums]"
    hints:
      - Expression can be ternary
      - Value comes before 'for'
    tags: [comprehensions, ternary, transformation]

  # --- Dict Comp Additional ---
  - slug: dict-comp-zip
    objective: "Create a dictionary comprehension using zip with two lists"
    title: Dict from Two Lists
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [comprehensions.dict-comp]
    type: write
    pattern: construction
    prompt: Create dict from keys list and values list using comprehension
    expected_answer: "{k: v for k, v in zip(keys, values)}"
    hints:
      - Use zip to pair them
    tags: [comprehensions, dict, zip]

  # --- Fill-in Exercises ---
  - slug: list-comp-for-fill
    objective: Complete list comprehension for clause
    title: List Comp For Fill-in
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: intro
    prereqs: [control-flow.for]
    type: fill-in
    blank_position: 0
    pattern: mapping
    prompt: Complete the list comprehension
    template: "[x * 2 ___ x in range(5)]"
    expected_answer: "for"
    hints:
      - Keyword for iteration in comprehension
    tags: [comprehensions, list-comp, fill-in]

  - slug: list-comp-if-fill
    objective: Complete list comprehension condition
    title: List Comp If Fill-in
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: fill-in
    blank_position: 0
    pattern: filtering
    prompt: Complete the filter condition
    template: "[x for x in range(10) ___ x % 2 == 0]"
    expected_answer: "if"
    hints:
      - Keyword for filtering in comprehension
    tags: [comprehensions, list-comp, fill-in]

  - slug: dict-comp-colon-fill
    objective: Complete dict comprehension syntax
    title: Dict Comp Syntax Fill-in
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: fill-in
    blank_position: 0
    pattern: mapping
    prompt: Complete the key-value separator
    template: "{x ___ x**2 for x in range(3)}"
    expected_answer: ":"
    hints:
      - Separator between key and value
    tags: [comprehensions, dict-comp, fill-in]

  - slug: set-comp-brace-fill
    objective: Identify set comprehension syntax
    title: Set Comp Syntax Fill-in
    difficulty: 2
    concept: comprehensions
    subconcept: set-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: fill-in
    blank_position: 0
    pattern: mapping
    prompt: Complete to create a set (unique values)
    template: "___x for x in [1, 1, 2, 2, 3]}"
    expected_answer: "{"
    hints:
      - Same as dict but without colon
      - Creates unique values
    tags: [comprehensions, set-comp, fill-in]

  # --- Predict Exercises ---
  - slug: list-comp-predict
    objective: Predict list comprehension output
    title: List Comp Predict
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: intro
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: mapping
    generator: comp-mapping
    prompt: What does this code produce?
    code: |
      result = [x * {{m}} for x in range({{n}})]
      print(result)
    expected_answer: "{{result}}"
    hints:
      - Multiplies each number 0-{{n}} by {{m}}
    tags: [comprehensions, list-comp, predict, dynamic]

  - slug: list-comp-filter-predict
    objective: Predict filtered list comprehension
    title: Filtered List Comp Predict
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: filtering
    generator: comp-filter
    prompt: What does this code produce?
    code: |
      result = [x for x in range({{n}}) if x % {{mod}} == 0]
      print(result)
    expected_answer: "{{result}}"
    hints:
      - Only includes numbers divisible by {{mod}}
    tags: [comprehensions, list-comp, predict, dynamic]

  - slug: dict-comp-predict
    objective: Predict dict comprehension output
    title: Dict Comp Predict
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [comprehensions.dict-comp]
    type: predict
    pattern: mapping
    prompt: What does this code produce?
    code: |
      result = {x: x**2 for x in range(3)}
      print(result)
    expected_answer: "{0: 0, 1: 1, 2: 4}"
    hints:
      - Maps each number to its square
    tags: [comprehensions, dict-comp, predict]

  - slug: nested-comp-predict
    objective: Predict nested comprehension output
    title: Nested Comp Predict
    difficulty: 3
    concept: comprehensions
    subconcept: list-comp
    level: edge
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: mapping
    prompt: What does this code produce?
    code: |
      matrix = [[1, 2], [3, 4]]
      result = [x for row in matrix for x in row]
      print(result)
    expected_answer: "[1, 2, 3, 4]"
    hints:
      - Flattens the nested list
    tags: [comprehensions, nested, predict]

  # --- Dynamic Dict Comprehension Exercises ---
  - slug: dict-comp-dynamic
    objective: Predict dictionary comprehension output
    title: Dynamic Dict Comp
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [comprehensions.dict-comp]
    type: predict
    pattern: mapping
    generator: dict-comp
    prompt: "What does this code produce?"
    code: |
      result = {{code}}
      print(result)
    expected_answer: "{{result}}"
    hints:
      - "This comprehension {{description}}"
    tags: [comprehensions, dict-comp, predict, dynamic]

  - slug: dict-comp-write-dynamic
    objective: Write a dictionary comprehension
    title: Dynamic Dict Comp Write
    difficulty: 2
    concept: comprehensions
    subconcept: dict-comp
    level: practice
    prereqs: [comprehensions.dict-comp]
    type: write
    pattern: mapping
    generator: dict-comp
    prompt: "Write a dict comprehension that {{description}} for range({{n}})"
    expected_answer: "{{code}}"
    hints:
      - "Use {key: value for x in range({{n}})}"
    tags: [comprehensions, dict-comp, write, dynamic]

  # --- List Transform Exercises (using list-transform generator) ---
  - slug: list-comp-transform-dynamic
    objective: Predict the output of a list transformation comprehension
    title: Dynamic List Transform
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: mapping
    generator: list-transform
    prompt: "What does this code print?"
    code: "{{code}}"
    expected_answer: "{{outputStr}}"
    hints:
      - "This comprehension will {{description}}"
      - "Start with the input {{inputStr}}"
    tags: [comprehensions, list-comp, transform, dynamic]
    target_construct:
      type: comprehension
      feedback: "List comprehensions are a concise way to transform lists"

  - slug: list-comp-filter-dynamic
    objective: Predict the output of a filtering list comprehension
    title: Dynamic List Filter
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: predict
    pattern: filtering
    generator: list-transform
    prompt: "What does this code print?"
    code: "{{code}}"
    expected_answer: "{{outputStr}}"
    hints:
      - "The filter will {{description}}"
      - "Check which elements pass the condition"
    tags: [comprehensions, list-comp, filter, dynamic]
    target_construct:
      type: comprehension
      feedback: "Use list comprehensions with if clauses to filter elements"

  - slug: list-comp-write-transform-dynamic
    objective: Write a list comprehension to transform values
    title: Dynamic List Comp Write
    difficulty: 2
    concept: comprehensions
    subconcept: list-comp
    level: practice
    prereqs: [comprehensions.list-comp]
    type: write
    pattern: mapping
    generator: list-transform
    prompt: "Write a list comprehension to {{description}} from nums = {{inputStr}}"
    expected_answer: "{{expression}}"
    hints:
      - "Use [expression for x in nums] syntax"
      - "The expression should {{description}}"
    tags: [comprehensions, list-comp, write, dynamic]
    target_construct:
      type: comprehension
      feedback: "List comprehensions are more Pythonic than explicit loops"
